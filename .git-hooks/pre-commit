#!/usr/bin/env bash
set -euo pipefail

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${YELLOW}[pre-commit]${NC} Checking format..."

if ./mill __.checkFormat 2>&1; then
    echo -e "${GREEN}[pre-commit] Format check passed.${NC}"
else
    echo ""
    echo -e "${RED}╔══════════════════════════════════════════════════╗${NC}"
    echo -e "${RED}║           FORMAT CHECK FAILED                   ║${NC}"
    echo -e "${RED}╠══════════════════════════════════════════════════╣${NC}"
    echo -e "${RED}║ Run the following to fix:                       ║${NC}"
    echo -e "${RED}║   ./mill __.reformat                            ║${NC}"
    echo -e "${RED}║ Then re-stage the changed files and commit.     ║${NC}"
    echo -e "${RED}║                                                 ║${NC}"
    echo -e "${RED}║ Bypass with --no-verify (not recommended).      ║${NC}"
    echo -e "${RED}╚══════════════════════════════════════════════════╝${NC}"
    exit 1
fi
